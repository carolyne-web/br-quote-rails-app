<!-- app/views/quotations/show.html.erb -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900"><%= @quotation.project_name %></h1>
          <p class="mt-2 text-gray-600">Quote #<%= @quotation.project_number %></p>
        </div>
        <div class="flex items-center gap-4">
          <!-- Status Badge -->
          <span class="px-4 py-2 rounded-full text-sm font-semibold
            <%= @quotation.status == 'draft' ? 'bg-gray-100 text-gray-800' : '' %>
            <%= @quotation.status == 'sent' ? 'bg-blue-100 text-blue-800' : '' %>
            <%= @quotation.status == 'approved' ? 'bg-green-100 text-green-800' : '' %>
            <%= @quotation.status == 'rejected' ? 'bg-red-100 text-red-800' : '' %>">
            <%= @quotation.status.capitalize %>
          </span>

          <!-- Action Buttons -->
          <div class="flex gap-2">
            <%= link_to edit_quotation_path(@quotation),
                class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" do %>
              <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Edit
            <% end %>

            <%= link_to pdf_quotation_path(@quotation),
                target: "_blank",
                class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" do %>
              <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Download PDF
            <% end %>

            <%= button_to duplicate_quotation_path(@quotation),
                method: :post,
                class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" do %>
              <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
              Duplicate
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Project Information -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Project Information</h2>
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <dt class="text-sm font-medium text-gray-500">Production House</dt>
              <dd class="mt-1 text-sm text-gray-900"><%= @quotation.production_house&.name %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Created Date</dt>
              <dd class="mt-1 text-sm text-gray-900"><%= @quotation.created_at.strftime('%B %d, %Y') %></dd>
            </div>
          </dl>
        </div>

        <!-- Talent Section -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex items-center mb-4">
            <svg class="w-6 h-6 text-indigo-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
            </svg>
            <h2 class="text-xl font-semibold text-gray-900">Talent</h2>
          </div>

          <!-- Talent Table -->
          <div class="overflow-x-auto">
            <table class="w-full border-collapse border border-gray-300">
              <thead>
                <tr class="bg-gray-100 border-b border-gray-300">
                  <th class="text-center py-2 px-3 text-sm font-medium text-gray-700 border-r border-gray-300">Talent Category</th>
                  <th class="text-center py-2 px-3 text-sm font-medium text-gray-700 border-r border-gray-300">Day Fee</th>
                  <th class="text-center py-2 px-3 text-sm font-medium text-gray-700 border-r border-gray-300">Count</th>
                  <th class="text-center py-2 px-3 text-sm font-medium text-gray-700 border-r border-gray-300">Days</th>
                  <th class="text-center py-2 px-3 text-sm font-medium text-gray-700">Total (R)</th>
                </tr>
              </thead>
              <tbody class="bg-white">
                <% @talent_categories.each do |category| %>
                  <% if category.day_on_sets.any? %>
                    <% category.day_on_sets.each do |dos| %>
                      <tr class="border-b border-gray-300">
                        <td class="py-2 px-3 text-sm text-gray-800 border-r border-gray-300">
                          <div class="flex items-center">
                            <div class="w-6 h-6 bg-indigo-100 rounded flex items-center justify-center text-indigo-600 font-bold text-xs mr-2">
                              <%= category.icon %>
                            </div>
                            <%= category.display_name %>
                          </div>
                        </td>
                        <td class="py-2 px-3 text-sm text-gray-800 text-right border-r border-gray-300">R<%= number_with_delimiter(category.daily_rate || category.default_daily_rate) %></td>
                        <td class="py-2 px-3 text-sm text-gray-800 text-center border-r border-gray-300"><%= dos.talent_count %></td>
                        <td class="py-2 px-3 text-sm text-gray-800 text-center border-r border-gray-300"><%= dos.days_count %></td>
                        <td class="py-2 px-3 text-sm text-gray-800 text-right">R<%= number_with_delimiter(dos.talent_count * dos.days_count * (category.daily_rate || category.default_daily_rate)) %></td>
                      </tr>
                    <% end %>
                  <% else %>
                    <tr class="border-b border-gray-300">
                      <td class="py-2 px-3 text-sm text-gray-800 border-r border-gray-300">
                        <div class="flex items-center">
                          <div class="w-6 h-6 bg-indigo-100 rounded flex items-center justify-center text-indigo-600 font-bold text-xs mr-2">
                            <%= category.icon %>
                          </div>
                          <%= category.display_name %>
                        </div>
                      </td>
                      <td class="py-2 px-3 text-sm text-gray-800 text-right border-r border-gray-300">R<%= number_with_delimiter(category.daily_rate || category.default_daily_rate) %></td>
                      <td class="py-2 px-3 text-sm text-gray-800 text-center border-r border-gray-300"><%= category.initial_count %></td>
                      <td class="py-2 px-3 text-sm text-gray-800 text-center border-r border-gray-300"><%= @quotation_detail&.shoot_days || 1 %></td>
                      <td class="py-2 px-3 text-sm text-gray-800 text-right">R<%= number_with_delimiter(category.total_cost) %></td>
                    </tr>
                  <% end %>
                <% end %>

                <!-- Talent Subtotal Row -->
                <tr class="border-t border-gray-400 font-semibold bg-gray-50">
                  <td colspan="4" class="text-right py-2 px-3 text-sm text-gray-800 border-r border-gray-300">Talent Subtotal:</td>
                  <td class="py-2 px-3 text-sm text-gray-800 text-right">R<%= number_with_delimiter(@calculation[:base_talent_cost]) %></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Usage Section -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex items-center mb-4">
            <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <h2 class="text-xl font-semibold text-gray-900">Usage & Buyout</h2>
          </div>

          <!-- Usage Details Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
            <!-- Territories -->
            <% if @territories.any? %>
              <div class="bg-blue-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-blue-900 mb-2">Territories</h3>
                <div class="space-y-1">
                  <% @territories.each do |territory| %>
                    <div class="flex justify-between items-center text-sm">
                      <span class="text-blue-800"><%= territory.name %></span>
                      <span class="font-medium text-blue-900"><%= territory.percentage %>%</span>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>

            <!-- Duration -->
            <% if @quotation_detail&.duration %>
              <div class="bg-green-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-green-900 mb-2">Duration</h3>
                <div class="text-lg font-semibold text-green-800">
                  <%= @quotation_detail.duration.humanize %>
                </div>
              </div>
            <% end %>

            <!-- Media Type -->
            <% if @quotation_detail&.media_type %>
              <div class="bg-purple-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-purple-900 mb-2">Media Type</h3>
                <div class="text-lg font-semibold text-purple-800">
                  <%= @quotation_detail.media_type.humanize %>
                </div>
              </div>
            <% end %>

            <!-- Exclusivity -->
            <% if @quotation_detail&.exclusivity_type %>
              <div class="bg-orange-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-orange-900 mb-2">Exclusivity</h3>
                <div class="text-lg font-semibold text-orange-800">
                  <%= @quotation_detail.exclusivity_type.humanize %>
                </div>
              </div>
            <% end %>

            <!-- Product Type -->
            <% if @quotation.product_type %>
              <div class="bg-indigo-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-indigo-900 mb-2">Product Type</h3>
                <div class="text-lg font-semibold text-indigo-800">
                  <%= @quotation.product_type.humanize %>
                </div>
              </div>
            <% end %>

            <!-- Buyout Percentage -->
            <div class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-sm font-medium text-gray-900 mb-2">Buyout Rate</h3>
              <div class="text-lg font-semibold text-gray-800">
                <%= @calculation[:territory_multiplier] ? ((@calculation[:territory_multiplier] - 1) * 100).round : 0 %>%
              </div>
            </div>
          </div>

          <!-- Usage Fee Calculation -->
          <div class="bg-purple-50 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="text-lg font-medium text-purple-900">Usage/Buyout Total</span>
              <span class="text-2xl font-bold text-purple-800">R<%= number_with_delimiter(@calculation[:usage_fee]) %></span>
            </div>
            <div class="text-sm text-purple-700 mt-1">
              Based on talent fees Ã— buyout percentage
            </div>
          </div>
        </div>

        <!-- Schedule Details -->
        <% if @quotation_detail %>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Schedule Details</h2>
            <div class="grid grid-cols-3 gap-4">
              <div class="text-center p-4 bg-gray-50 rounded-lg">
                <div class="text-2xl font-bold text-gray-900"><%= @quotation_detail.rehearsal_days || 0 %></div>
                <div class="text-sm text-gray-500">Rehearsal Days</div>
              </div>
              <div class="text-center p-4 bg-gray-50 rounded-lg">
                <div class="text-2xl font-bold text-gray-900"><%= @quotation_detail.travel_days || 0 %></div>
                <div class="text-sm text-gray-500">Travel Days</div>
              </div>
              <div class="text-center p-4 bg-gray-50 rounded-lg">
                <div class="text-2xl font-bold text-gray-900"><%= @quotation_detail.down_days || 0 %></div>
                <div class="text-sm text-gray-500">Down Days</div>
              </div>
            </div>
          </div>
        <% end %>


        <!-- Adjustments -->
        <% if @adjustments.any? %>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Adjustments</h2>
            <div class="space-y-3">
              <% @adjustments.each do |adjustment| %>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <div>
                    <div class="text-sm font-medium text-gray-900"><%= adjustment.description || adjustment.adjustment_type.humanize %></div>
                  </div>
                  <div class="text-sm font-semibold text-<%= adjustment.adjustment_type == 'discount' ? 'red' : 'green' %>-600">
                    <%= adjustment.adjustment_type == 'discount' ? '-' : '+' %><%= adjustment.percentage %>%
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Total Summary -->
      <div class="lg:col-span-1">
        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 text-white sticky top-8">
          <h3 class="text-xl font-semibold mb-6">Quote Summary</h3>

          <div class="space-y-3">
            <div class="flex justify-between text-sm">
              <span class="text-indigo-100">A) Talent Fees</span>
              <span class="font-semibold">R<%= number_with_delimiter(@calculation[:base_talent_cost]) %></span>
            </div>

            <div class="flex justify-between text-sm">
              <span class="text-indigo-100">B) Usage/Buyout</span>
              <span class="font-semibold">R<%= number_with_delimiter(@calculation[:usage_fee]) %></span>
            </div>

            <% if @calculation[:manual_adjustment] != 0 %>
              <div class="flex justify-between text-sm">
                <span class="text-indigo-100">C) Adjustments</span>
                <span class="font-semibold">R<%= number_with_delimiter(@calculation[:manual_adjustment]) %></span>
              </div>
            <% end %>

            <div class="pt-4 mt-4 border-t border-indigo-400">
              <div class="flex justify-between items-end">
                <span class="text-lg">Total Quote</span>
                <span class="text-3xl font-bold">R<%= number_with_delimiter(@calculation[:total]) %></span>
              </div>
            </div>

            <!-- Key Details -->
            <div class="pt-4 mt-4 border-t border-indigo-400">
              <div class="space-y-1 text-xs">
                <% if @quotation_detail&.duration %>
                  <div class="flex justify-between">
                    <span class="text-indigo-100">Duration:</span>
                    <span><%= @quotation_detail.duration.humanize %></span>
                  </div>
                <% end %>
                <% if @territories.any? %>
                  <div class="flex justify-between">
                    <span class="text-indigo-100">Territories:</span>
                    <span><%= @territories.count %> selected</span>
                  </div>
                <% end %>
                <% if @quotation_detail&.exclusivity_type %>
                  <div class="flex justify-between">
                    <span class="text-indigo-100">Exclusivity:</span>
                    <span><%= @quotation_detail.exclusivity_type.humanize %></span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
